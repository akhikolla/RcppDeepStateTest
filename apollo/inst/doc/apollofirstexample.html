<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="David Palma, Stephane Hess" />

<meta name="date" content="2020-03-16" />

<title>Model file examples</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Model file examples</h1>
<h4 class="author">David Palma, Stephane Hess</h4>
<h4 class="date">2020-03-16</h4>



<div id="about-the-package" class="section level2">
<h2>About the package</h2>
<p><em>Apollo</em> is an R package designed for estimation and analysis of choice models (Train, 2008). This package allows estimating Multinomial logit (MNL), Nested logit (NL), cross-nested logit (CNL), exploded logit (EL), ordered logit (OL), Integrated Choice and Latent Variable (ICLV, Ben-Akiva et al. 2002), Multiple Discrete-Continuous Extreme Value (MDCEV, Bhat 2008), nested MDCEV (MDCNEV, Pinjari and Bhat 2010), and Decision Field Theory (DFT, Hancock and Hess 2018) models. All models support both continuous and discrete mixing (e.g. continuous random parameters, latent classes or finite mixtures), both between and within individuals (i.e at the individual and observation level). Different models can be easily combined for joint estimation. The package allows for classical estimation (i.e. maximum likelihood) as well as Bayesian estimation (i.e. hierarchical Bayes, through package RSGHB).</p>
<p>All functionalities are described in the manual, available at www.ApolloChoiceModelling.com. Examples can also be found on the website.</p>
</div>
<div id="recommended-workflow" class="section level2">
<h2>Recommended workflow</h2>
<p>The recommended way to use <em>Apollo</em> is to create a different R script for each model to estimate. These scripts are refer to as <em>model files</em> and contain all the necessary information to estimate the model (except for the data), and can also include post-estimation analysis of the results.</p>
<p>A model file should be structured around the following sections:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Definition of core settings</strong>: In this section the <em>Apollo</em> library is loaded, and global variables such as the name of the model are defined.</p></li>
<li><p><strong>Data loading</strong>: In this section the database is loaded. Any transformation to the data that does not depend on parameters to be estimated (e.g. averages of explanatory variables) should be performed here and stored inside the database object.</p></li>
<li><p><strong>Parameter definition</strong>: In this section, a vector containing the names and starting values of parameters is defined, as well as details of their mixing distributions if present.</p></li>
<li><p><strong>Input validation</strong>: In this section, all inputs prepared in the previous sections are validated and stored together.</p></li>
<li><p><strong>Likelihood definition</strong>: In this section, the user must write a function that calculates the model likelihood.</p></li>
<li><p><strong>Model estimation and reporting</strong>: In this section, the model is estimated and the results are displayed.</p></li>
<li><p><strong>Postprocessing of results</strong>: This is an optional section where the user can do forecasting and other post-processing of the estrimated model.</p></li>
</ol>
<p>In this document, we present two example model files: a multinomial logit (MNL) model, and a mixed multinomial logit (MMNL) model. More examples, discussed in more detail are available at www.ApolloChoiceModelling.com.</p>
</div>
<div id="mnl-model-file-example" class="section level2">
<h2>MNL model file example</h2>
<p>In this section, we present code to estimate an MNL model using the synthetic data included in the package. In the postprocessing, we predict the impact on mode share of a 10% increase in the cost of the train fare. The utility functions of alternatives are defined as follows.</p>
<p><span class="math display">\[U_{nsi} = asc_i + \beta_{tt}tt_{nsi} + \beta_{c}*cost_{nsi} + \varepsilon_{nsi}\]</span></p>
<p>Where <em>n</em> indexes individuals, <em>s</em> choice scenarios, and <em>i</em> alternatives. <span class="math inline">\(asc_i\)</span> is the alternative specific constant, <span class="math inline">\(tt_{nsi}\)</span> is the travel time and <span class="math inline">\(cost_{nsi}\)</span> is the cost. <span class="math inline">\(\varepsilon_{nsi}\)</span> is an independent identically distributed standard Gumbel error term. <span class="math inline">\(asc_i\)</span>, <span class="math inline">\(\beta_{tt}\)</span> and <span class="math inline">\(\beta_{c}\)</span> are parameters to be estimated.</p>
<p>The likelihood function of this model for individual <span class="math inline">\(n\)</span> is as follows.</p>
<p><span class="math display">\[L_{n}=\prod_{s}P_{nsi}\]</span></p>
<p>Where <span class="math display">\[P_{nsi}=\frac{e^{V_{nsi}}}{\sum_{j}e^{V_{nsj}}}\]</span> And <span class="math inline">\(V_{nsi}=U_{nsi}-\varepsilon_{nsi}\)</span>, i.e. the deterministic part of the utility.</p>
<p>The likelihood function of the MNL model is pre-coded in <code>Apollo</code>, so we do not need to type it ourselves. However, if the user prefers to write the likelihood themselves, they can also do it. The pre-coded MNL likelihood function (<code>apollo_mnl</code>) requires a series of inputs defined inside the <code>mnl_settings</code> object.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#### 1. Definition of core settings                        </span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">### Clear memory</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">### Load libraries</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">library</span>(apollo)</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; Apollo 0.1.0</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; www.ApolloChoiceModelling.com</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt; See url for a detailed manual, examples and a help forum.</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; Sign up to our mailing list for updates on new releases.</span></a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">### Initialise code</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="kw">apollo_initialise</span>()</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">### Set core controls</span></a>
<a class="sourceLine" id="cb1-19" title="19">apollo_control =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1-20" title="20">  <span class="dt">modelName  =</span><span class="st">&quot;MNL&quot;</span>,</a>
<a class="sourceLine" id="cb1-21" title="21">  <span class="dt">modelDescr =</span><span class="st">&quot;Simple MNL model on mode choice SP data&quot;</span>,</a>
<a class="sourceLine" id="cb1-22" title="22">  <span class="dt">indivID    =</span><span class="st">&quot;ID&quot;</span></a>
<a class="sourceLine" id="cb1-23" title="23">)</a>
<a class="sourceLine" id="cb1-24" title="24"></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co">#### 2. Data loading                                   ####</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-28" title="28"></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="kw">data</span>(<span class="st">&quot;apollo_modeChoiceData&quot;</span>)</a>
<a class="sourceLine" id="cb1-30" title="30">database =<span class="st"> </span>apollo_modeChoiceData</a>
<a class="sourceLine" id="cb1-31" title="31"><span class="kw">rm</span>(apollo_modeChoiceData)</a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="co">### Use only SP data</span></a>
<a class="sourceLine" id="cb1-34" title="34">database =<span class="st"> </span><span class="kw">subset</span>(database,database<span class="op">$</span>SP<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-35" title="35"></a>
<a class="sourceLine" id="cb1-36" title="36"><span class="co">### Create new variable with average income</span></a>
<a class="sourceLine" id="cb1-37" title="37">database<span class="op">$</span>mean_income =<span class="st"> </span><span class="kw">mean</span>(database<span class="op">$</span>income)</a>
<a class="sourceLine" id="cb1-38" title="38"></a>
<a class="sourceLine" id="cb1-39" title="39"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">#### 3. Parameter definition                           ####</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-42" title="42"></a>
<a class="sourceLine" id="cb1-43" title="43"><span class="co">### Vector of parameters, including any that are kept fixed </span></a>
<a class="sourceLine" id="cb1-44" title="44"><span class="co">### during estimation</span></a>
<a class="sourceLine" id="cb1-45" title="45">apollo_beta=<span class="kw">c</span>(<span class="dt">asc_car  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-46" title="46">              <span class="dt">asc_bus  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-47" title="47">              <span class="dt">asc_air  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-48" title="48">              <span class="dt">asc_rail =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-49" title="49">              <span class="dt">b_tt_car =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-50" title="50">              <span class="dt">b_tt_bus =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-51" title="51">              <span class="dt">b_tt_air =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-52" title="52">              <span class="dt">b_tt_rail=</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-53" title="53">              <span class="dt">b_c      =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-54" title="54"></a>
<a class="sourceLine" id="cb1-55" title="55"><span class="co">### Vector with names (in quotes) of parameters to be</span></a>
<a class="sourceLine" id="cb1-56" title="56"><span class="co">###  kept fixed at their starting value in apollo_beta.</span></a>
<a class="sourceLine" id="cb1-57" title="57"><span class="co">### Use apollo_beta_fixed = c() for no fixed parameters.</span></a>
<a class="sourceLine" id="cb1-58" title="58">apollo_fixed =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;asc_car&quot;</span>)</a>
<a class="sourceLine" id="cb1-59" title="59"></a>
<a class="sourceLine" id="cb1-60" title="60"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-61" title="61"><span class="co">#### 4. Input validation                               ####</span></a>
<a class="sourceLine" id="cb1-62" title="62"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-63" title="63"></a>
<a class="sourceLine" id="cb1-64" title="64">apollo_inputs =<span class="st"> </span><span class="kw">apollo_validateInputs</span>()</a>
<a class="sourceLine" id="cb1-65" title="65"><span class="co">#&gt; Missing setting for mixing, set to default of FALSE</span></a>
<a class="sourceLine" id="cb1-66" title="66"><span class="co">#&gt; Missing setting for nCores, set to default of 1</span></a>
<a class="sourceLine" id="cb1-67" title="67"><span class="co">#&gt; Missing setting for workInLogs, set to default of FALSE</span></a>
<a class="sourceLine" id="cb1-68" title="68"><span class="co">#&gt; Missing setting for seed, set to default of 13</span></a>
<a class="sourceLine" id="cb1-69" title="69"><span class="co">#&gt; Missing setting for HB, set to default of FALSE</span></a>
<a class="sourceLine" id="cb1-70" title="70"><span class="co">#&gt; Several observations per individual detected based on the value of ID.</span></a>
<a class="sourceLine" id="cb1-71" title="71"><span class="co">#&gt;   Setting panelData set to TRUE.</span></a>
<a class="sourceLine" id="cb1-72" title="72"><span class="co">#&gt; All checks on apollo_control completed.</span></a>
<a class="sourceLine" id="cb1-73" title="73"><span class="co">#&gt; All checks on data completed.</span></a>
<a class="sourceLine" id="cb1-74" title="74"></a>
<a class="sourceLine" id="cb1-75" title="75"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-76" title="76"><span class="co">#### 5. Likelihood definition                          ####</span></a>
<a class="sourceLine" id="cb1-77" title="77"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-78" title="78"></a>
<a class="sourceLine" id="cb1-79" title="79">apollo_probabilities=<span class="cf">function</span>(apollo_beta, apollo_inputs, </a>
<a class="sourceLine" id="cb1-80" title="80">                              <span class="dt">functionality=</span><span class="st">&quot;estimate&quot;</span>){</a>
<a class="sourceLine" id="cb1-81" title="81"></a>
<a class="sourceLine" id="cb1-82" title="82">  <span class="co">### Attach inputs and detach after function exit</span></a>
<a class="sourceLine" id="cb1-83" title="83">  <span class="kw">apollo_attach</span>(apollo_beta, apollo_inputs)</a>
<a class="sourceLine" id="cb1-84" title="84">  <span class="kw">on.exit</span>(<span class="kw">apollo_detach</span>(apollo_beta, apollo_inputs))</a>
<a class="sourceLine" id="cb1-85" title="85"></a>
<a class="sourceLine" id="cb1-86" title="86">  <span class="co">### Create list of probabilities P</span></a>
<a class="sourceLine" id="cb1-87" title="87">  P =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1-88" title="88">  </a>
<a class="sourceLine" id="cb1-89" title="89">  <span class="co">### List of utilities: these must use the same names as</span></a>
<a class="sourceLine" id="cb1-90" title="90">  <span class="co">### in mnl_settings, order is irrelevant.</span></a>
<a class="sourceLine" id="cb1-91" title="91">  V =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1-92" title="92">  V[[<span class="st">&#39;car&#39;</span>]] =<span class="st"> </span>asc_car <span class="op">+</span><span class="st"> </span>b_tt_car <span class="op">*</span>time_car <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_car</a>
<a class="sourceLine" id="cb1-93" title="93">  V[[<span class="st">&#39;bus&#39;</span>]] =<span class="st"> </span>asc_bus <span class="op">+</span><span class="st"> </span>b_tt_bus <span class="op">*</span>time_bus <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_bus</a>
<a class="sourceLine" id="cb1-94" title="94">  V[[<span class="st">&#39;air&#39;</span>]] =<span class="st"> </span>asc_air <span class="op">+</span><span class="st"> </span>b_tt_air <span class="op">*</span>time_air <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_air</a>
<a class="sourceLine" id="cb1-95" title="95">  V[[<span class="st">&#39;rail&#39;</span>]]=<span class="st"> </span>asc_rail<span class="op">+</span><span class="st"> </span>b_tt_rail<span class="op">*</span>time_rail<span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_rail</a>
<a class="sourceLine" id="cb1-96" title="96">  </a>
<a class="sourceLine" id="cb1-97" title="97">  <span class="co">### Define settings for MNL model component</span></a>
<a class="sourceLine" id="cb1-98" title="98">  mnl_settings =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1-99" title="99">    <span class="dt">alternatives  =</span> <span class="kw">c</span>(<span class="dt">car=</span><span class="dv">1</span>, <span class="dt">bus=</span><span class="dv">2</span>, <span class="dt">air=</span><span class="dv">3</span>, <span class="dt">rail=</span><span class="dv">4</span>), </a>
<a class="sourceLine" id="cb1-100" title="100">    <span class="dt">avail         =</span> <span class="kw">list</span>(<span class="dt">car=</span>av_car, <span class="dt">bus=</span>av_bus, </a>
<a class="sourceLine" id="cb1-101" title="101">                         <span class="dt">air=</span>av_air, <span class="dt">rail=</span>av_rail), </a>
<a class="sourceLine" id="cb1-102" title="102">    <span class="dt">choiceVar     =</span> choice,</a>
<a class="sourceLine" id="cb1-103" title="103">    <span class="dt">V             =</span> V</a>
<a class="sourceLine" id="cb1-104" title="104">  )</a>
<a class="sourceLine" id="cb1-105" title="105">  </a>
<a class="sourceLine" id="cb1-106" title="106">  <span class="co">### Compute probabilities using MNL model</span></a>
<a class="sourceLine" id="cb1-107" title="107">  P[[<span class="st">&#39;model&#39;</span>]] =<span class="st"> </span><span class="kw">apollo_mnl</span>(mnl_settings, functionality)</a>
<a class="sourceLine" id="cb1-108" title="108"></a>
<a class="sourceLine" id="cb1-109" title="109">  <span class="co">### Take product across observation for same individual</span></a>
<a class="sourceLine" id="cb1-110" title="110">  P =<span class="st"> </span><span class="kw">apollo_panelProd</span>(P, apollo_inputs, functionality)</a>
<a class="sourceLine" id="cb1-111" title="111"></a>
<a class="sourceLine" id="cb1-112" title="112">  <span class="co">### Prepare and return outputs of function</span></a>
<a class="sourceLine" id="cb1-113" title="113">  P =<span class="st"> </span><span class="kw">apollo_prepareProb</span>(P, apollo_inputs, functionality)</a>
<a class="sourceLine" id="cb1-114" title="114">  <span class="kw">return</span>(P)</a>
<a class="sourceLine" id="cb1-115" title="115">}</a>
<a class="sourceLine" id="cb1-116" title="116"></a>
<a class="sourceLine" id="cb1-117" title="117"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-118" title="118"><span class="co">#### 6. Model estimation and reporting                 ####</span></a>
<a class="sourceLine" id="cb1-119" title="119"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-120" title="120"></a>
<a class="sourceLine" id="cb1-121" title="121">model =<span class="st"> </span><span class="kw">apollo_estimate</span>(apollo_beta, apollo_fixed, </a>
<a class="sourceLine" id="cb1-122" title="122">                        apollo_probabilities, </a>
<a class="sourceLine" id="cb1-123" title="123">                        apollo_inputs)</a>
<a class="sourceLine" id="cb1-124" title="124"><span class="co">#&gt; Validating inputs of likelihood function (apollo_probabilities)</span></a>
<a class="sourceLine" id="cb1-125" title="125"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-126" title="126"><span class="co">#&gt; Overview of choices for model component &quot;MNL&quot;</span></a>
<a class="sourceLine" id="cb1-127" title="127"><span class="co">#&gt;                                      car     bus     air    rail</span></a>
<a class="sourceLine" id="cb1-128" title="128"><span class="co">#&gt; Times available                  5446.00 6314.00 5264.00 6118.00</span></a>
<a class="sourceLine" id="cb1-129" title="129"><span class="co">#&gt; Times chosen                     1946.00  358.00 1522.00 3174.00</span></a>
<a class="sourceLine" id="cb1-130" title="130"><span class="co">#&gt; Percentage chosen overall          27.80    5.11   21.74   45.34</span></a>
<a class="sourceLine" id="cb1-131" title="131"><span class="co">#&gt; Percentage chosen when available   35.73    5.67   28.91   51.88</span></a>
<a class="sourceLine" id="cb1-132" title="132"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-133" title="133"><span class="co">#&gt; Testing likelihood function ..........Done.</span></a>
<a class="sourceLine" id="cb1-134" title="134"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-135" title="135"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-136" title="136"><span class="co">#&gt; Starting main estimation</span></a>
<a class="sourceLine" id="cb1-137" title="137"><span class="co">#&gt; Initial function value: -8196.021 </span></a>
<a class="sourceLine" id="cb1-138" title="138"><span class="co">#&gt; Initial gradient value:</span></a>
<a class="sourceLine" id="cb1-139" title="139"><span class="co">#&gt;     asc_bus     asc_air    asc_rail    b_tt_car    b_tt_bus    b_tt_air </span></a>
<a class="sourceLine" id="cb1-140" title="140"><span class="co">#&gt;   -1599.667     -39.000    1302.667   92447.083 -597397.501   -1820.833 </span></a>
<a class="sourceLine" id="cb1-141" title="141"><span class="co">#&gt;   b_tt_rail         b_c </span></a>
<a class="sourceLine" id="cb1-142" title="142"><span class="co">#&gt;  189332.083    8862.500 </span></a>
<a class="sourceLine" id="cb1-143" title="143"><span class="co">#&gt; initial  value 8196.020532 </span></a>
<a class="sourceLine" id="cb1-144" title="144"><span class="co">#&gt; iter   2 value 7456.688617</span></a>
<a class="sourceLine" id="cb1-145" title="145"><span class="co">#&gt; iter   3 value 7375.154805</span></a>
<a class="sourceLine" id="cb1-146" title="146"><span class="co">#&gt; iter   4 value 7260.844459</span></a>
<a class="sourceLine" id="cb1-147" title="147"><span class="co">#&gt; iter   5 value 6670.816191</span></a>
<a class="sourceLine" id="cb1-148" title="148"><span class="co">#&gt; iter   6 value 6618.448416</span></a>
<a class="sourceLine" id="cb1-149" title="149"><span class="co">#&gt; iter   7 value 6471.224867</span></a>
<a class="sourceLine" id="cb1-150" title="150"><span class="co">#&gt; iter   8 value 6429.069520</span></a>
<a class="sourceLine" id="cb1-151" title="151"><span class="co">#&gt; iter   9 value 6216.357930</span></a>
<a class="sourceLine" id="cb1-152" title="152"><span class="co">#&gt; iter  10 value 6052.604904</span></a>
<a class="sourceLine" id="cb1-153" title="153"><span class="co">#&gt; iter  11 value 5838.718110</span></a>
<a class="sourceLine" id="cb1-154" title="154"><span class="co">#&gt; iter  12 value 5815.462115</span></a>
<a class="sourceLine" id="cb1-155" title="155"><span class="co">#&gt; iter  13 value 5804.515622</span></a>
<a class="sourceLine" id="cb1-156" title="156"><span class="co">#&gt; iter  14 value 5802.299705</span></a>
<a class="sourceLine" id="cb1-157" title="157"><span class="co">#&gt; iter  15 value 5802.031103</span></a>
<a class="sourceLine" id="cb1-158" title="158"><span class="co">#&gt; iter  16 value 5802.023289</span></a>
<a class="sourceLine" id="cb1-159" title="159"><span class="co">#&gt; iter  17 value 5802.022828</span></a>
<a class="sourceLine" id="cb1-160" title="160"><span class="co">#&gt; iter  17 value 5802.022826</span></a>
<a class="sourceLine" id="cb1-161" title="161"><span class="co">#&gt; iter  17 value 5802.022826</span></a>
<a class="sourceLine" id="cb1-162" title="162"><span class="co">#&gt; final  value 5802.022826 </span></a>
<a class="sourceLine" id="cb1-163" title="163"><span class="co">#&gt; converged</span></a>
<a class="sourceLine" id="cb1-164" title="164"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-165" title="165"><span class="co">#&gt; Estimated parameters:</span></a>
<a class="sourceLine" id="cb1-166" title="166"><span class="co">#&gt;              [,1]</span></a>
<a class="sourceLine" id="cb1-167" title="167"><span class="co">#&gt; asc_car    0.0000</span></a>
<a class="sourceLine" id="cb1-168" title="168"><span class="co">#&gt; asc_bus    0.0115</span></a>
<a class="sourceLine" id="cb1-169" title="169"><span class="co">#&gt; asc_air   -0.6495</span></a>
<a class="sourceLine" id="cb1-170" title="170"><span class="co">#&gt; asc_rail  -1.2357</span></a>
<a class="sourceLine" id="cb1-171" title="171"><span class="co">#&gt; b_tt_car  -0.0101</span></a>
<a class="sourceLine" id="cb1-172" title="172"><span class="co">#&gt; b_tt_bus  -0.0164</span></a>
<a class="sourceLine" id="cb1-173" title="173"><span class="co">#&gt; b_tt_air  -0.0118</span></a>
<a class="sourceLine" id="cb1-174" title="174"><span class="co">#&gt; b_tt_rail -0.0048</span></a>
<a class="sourceLine" id="cb1-175" title="175"><span class="co">#&gt; b_c       -0.0529</span></a>
<a class="sourceLine" id="cb1-176" title="176"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-177" title="177"><span class="co">#&gt; Computing covariance matrix using numDeriv package.</span></a>
<a class="sourceLine" id="cb1-178" title="178"><span class="co">#&gt;  (this may take a while)</span></a>
<a class="sourceLine" id="cb1-179" title="179"><span class="co">#&gt;  0%....25%....50%....75%....100%</span></a>
<a class="sourceLine" id="cb1-180" title="180"><span class="co">#&gt;  Hessian calculated with numDeriv will be used.</span></a>
<a class="sourceLine" id="cb1-181" title="181"><span class="co">#&gt;  Min abs eigenvalue of hessian    :  3.304525 </span></a>
<a class="sourceLine" id="cb1-182" title="182"><span class="co">#&gt; Calculating LL(0)... Done.</span></a>
<a class="sourceLine" id="cb1-183" title="183"><span class="co">#&gt; Calculating LL of each model component... Done.</span></a>
<a class="sourceLine" id="cb1-184" title="184"></a>
<a class="sourceLine" id="cb1-185" title="185"><span class="kw">apollo_modelOutput</span>(model)</a>
<a class="sourceLine" id="cb1-186" title="186"><span class="co">#&gt; Model run using Apollo for R, version 0.1.0 </span></a>
<a class="sourceLine" id="cb1-187" title="187"><span class="co">#&gt; www.ApolloChoiceModelling.com</span></a>
<a class="sourceLine" id="cb1-188" title="188"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-189" title="189"><span class="co">#&gt; Model name                       : MNL</span></a>
<a class="sourceLine" id="cb1-190" title="190"><span class="co">#&gt; Model description                : Simple MNL model on mode choice SP data</span></a>
<a class="sourceLine" id="cb1-191" title="191"><span class="co">#&gt; Model run at                     : 2020-03-16 11:06:31</span></a>
<a class="sourceLine" id="cb1-192" title="192"><span class="co">#&gt; Estimation method                : bfgs</span></a>
<a class="sourceLine" id="cb1-193" title="193"><span class="co">#&gt; Model diagnosis                  : successful convergence </span></a>
<a class="sourceLine" id="cb1-194" title="194"><span class="co">#&gt; Number of individuals            : 500</span></a>
<a class="sourceLine" id="cb1-195" title="195"><span class="co">#&gt; Number of observations           : 7000</span></a>
<a class="sourceLine" id="cb1-196" title="196"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-197" title="197"><span class="co">#&gt; Number of cores used             :  1 </span></a>
<a class="sourceLine" id="cb1-198" title="198"><span class="co">#&gt; Model without mixing</span></a>
<a class="sourceLine" id="cb1-199" title="199"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-200" title="200"><span class="co">#&gt; LL(start)                        : -8196.021</span></a>
<a class="sourceLine" id="cb1-201" title="201"><span class="co">#&gt; LL(0)                            : -8196.021</span></a>
<a class="sourceLine" id="cb1-202" title="202"><span class="co">#&gt; LL(final)                        : -5802.023</span></a>
<a class="sourceLine" id="cb1-203" title="203"><span class="co">#&gt; Rho-square (0)                   :  0.2921 </span></a>
<a class="sourceLine" id="cb1-204" title="204"><span class="co">#&gt; Adj.Rho-square (0)               :  0.2911 </span></a>
<a class="sourceLine" id="cb1-205" title="205"><span class="co">#&gt; AIC                              :  11620.05 </span></a>
<a class="sourceLine" id="cb1-206" title="206"><span class="co">#&gt; BIC                              :  11674.87 </span></a>
<a class="sourceLine" id="cb1-207" title="207"><span class="co">#&gt; Estimated parameters             :  8</span></a>
<a class="sourceLine" id="cb1-208" title="208"><span class="co">#&gt; Time taken (hh:mm:ss)            :  00:00:3.27 </span></a>
<a class="sourceLine" id="cb1-209" title="209"><span class="co">#&gt; Iterations                       :  19 </span></a>
<a class="sourceLine" id="cb1-210" title="210"><span class="co">#&gt; Min abs eigenvalue of hessian    :  3.304525 </span></a>
<a class="sourceLine" id="cb1-211" title="211"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-212" title="212"><span class="co">#&gt; Estimates:</span></a>
<a class="sourceLine" id="cb1-213" title="213"><span class="co">#&gt;           Estimate Std.err. t.ratio(0) Rob.std.err. Rob.t.ratio(0)</span></a>
<a class="sourceLine" id="cb1-214" title="214"><span class="co">#&gt; asc_car     0.0000       NA         NA           NA             NA</span></a>
<a class="sourceLine" id="cb1-215" title="215"><span class="co">#&gt; asc_bus     0.0115   0.5408       0.02       0.5411           0.02</span></a>
<a class="sourceLine" id="cb1-216" title="216"><span class="co">#&gt; asc_air    -0.6495   0.2699      -2.41       0.2666          -2.44</span></a>
<a class="sourceLine" id="cb1-217" title="217"><span class="co">#&gt; asc_rail   -1.2357   0.3218      -3.84       0.3125          -3.95</span></a>
<a class="sourceLine" id="cb1-218" title="218"><span class="co">#&gt; b_tt_car   -0.0101   0.0006     -15.75       0.0007         -15.30</span></a>
<a class="sourceLine" id="cb1-219" title="219"><span class="co">#&gt; b_tt_bus   -0.0164   0.0015     -11.30       0.0015         -11.11</span></a>
<a class="sourceLine" id="cb1-220" title="220"><span class="co">#&gt; b_tt_air   -0.0118   0.0024      -4.93       0.0024          -5.00</span></a>
<a class="sourceLine" id="cb1-221" title="221"><span class="co">#&gt; b_tt_rail  -0.0048   0.0016      -2.90       0.0016          -2.95</span></a>
<a class="sourceLine" id="cb1-222" title="222"><span class="co">#&gt; b_c        -0.0529   0.0014     -37.21       0.0017         -31.14</span></a>
<a class="sourceLine" id="cb1-223" title="223"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-224" title="224"><span class="co">#&gt; Overview of choices for model component &quot;MNL&quot;</span></a>
<a class="sourceLine" id="cb1-225" title="225"><span class="co">#&gt;                                      car     bus     air    rail</span></a>
<a class="sourceLine" id="cb1-226" title="226"><span class="co">#&gt; Times available                  5446.00 6314.00 5264.00 6118.00</span></a>
<a class="sourceLine" id="cb1-227" title="227"><span class="co">#&gt; Times chosen                     1946.00  358.00 1522.00 3174.00</span></a>
<a class="sourceLine" id="cb1-228" title="228"><span class="co">#&gt; Percentage chosen overall          27.80    5.11   21.74   45.34</span></a>
<a class="sourceLine" id="cb1-229" title="229"><span class="co">#&gt; Percentage chosen when available   35.73    5.67   28.91   51.88</span></a>
<a class="sourceLine" id="cb1-230" title="230"></a>
<a class="sourceLine" id="cb1-231" title="231"><span class="kw">apollo_saveOutput</span>(model)</a>
<a class="sourceLine" id="cb1-232" title="232"><span class="co">#&gt; Estimates saved to MNL_estimates.csv </span></a>
<a class="sourceLine" id="cb1-233" title="233"><span class="co">#&gt; Classical covariance matrix saved to MNL_covar.csv </span></a>
<a class="sourceLine" id="cb1-234" title="234"><span class="co">#&gt; Robust covariance matrix saved to MNL_robcovar.csv </span></a>
<a class="sourceLine" id="cb1-235" title="235"><span class="co">#&gt; Classical correlation matrix saved to MNL_covar.csv </span></a>
<a class="sourceLine" id="cb1-236" title="236"><span class="co">#&gt; Robust correlation matrix saved to MNL_robcorr.csv </span></a>
<a class="sourceLine" id="cb1-237" title="237"><span class="co">#&gt; Model object saved to MNL.rds</span></a>
<a class="sourceLine" id="cb1-238" title="238"></a>
<a class="sourceLine" id="cb1-239" title="239"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-240" title="240"><span class="co">#### 7. Postprocessing of results                      ####</span></a>
<a class="sourceLine" id="cb1-241" title="241"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb1-242" title="242"></a>
<a class="sourceLine" id="cb1-243" title="243"><span class="co">### Use the estimated model to make predictions</span></a>
<a class="sourceLine" id="cb1-244" title="244">predictions_base =<span class="st"> </span><span class="kw">apollo_prediction</span>(model, </a>
<a class="sourceLine" id="cb1-245" title="245">                                     apollo_probabilities, </a>
<a class="sourceLine" id="cb1-246" title="246">                                     apollo_inputs)</a>
<a class="sourceLine" id="cb1-247" title="247"><span class="co">#&gt; Updating inputs...Done.</span></a>
<a class="sourceLine" id="cb1-248" title="248"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-249" title="249"><span class="co">#&gt; Running predictions from model using parameter estimates Done.</span></a>
<a class="sourceLine" id="cb1-250" title="250"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-251" title="251"><span class="co">#&gt; Predicted demand at model estimates</span></a>
<a class="sourceLine" id="cb1-252" title="252"><span class="co">#&gt;       car       bus       air      rail </span></a>
<a class="sourceLine" id="cb1-253" title="253"><span class="co">#&gt; 1946.0001  357.9993 1521.9986 3174.0020</span></a>
<a class="sourceLine" id="cb1-254" title="254"></a>
<a class="sourceLine" id="cb1-255" title="255"><span class="co">### Now imagine the cost for rail increases by 10% </span></a>
<a class="sourceLine" id="cb1-256" title="256"><span class="co">### and predict again</span></a>
<a class="sourceLine" id="cb1-257" title="257">database<span class="op">$</span>cost_rail =<span class="st"> </span><span class="fl">1.1</span><span class="op">*</span>database<span class="op">$</span>cost_rail</a>
<a class="sourceLine" id="cb1-258" title="258">predictions_new =<span class="st"> </span><span class="kw">apollo_prediction</span>(model, </a>
<a class="sourceLine" id="cb1-259" title="259">                                    apollo_probabilities, </a>
<a class="sourceLine" id="cb1-260" title="260">                                    apollo_inputs)</a>
<a class="sourceLine" id="cb1-261" title="261"><span class="co">#&gt; Updating inputs...Done.</span></a>
<a class="sourceLine" id="cb1-262" title="262"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-263" title="263"><span class="co">#&gt; Running predictions from model using parameter estimates Done.</span></a>
<a class="sourceLine" id="cb1-264" title="264"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-265" title="265"><span class="co">#&gt; Predicted demand at model estimates</span></a>
<a class="sourceLine" id="cb1-266" title="266"><span class="co">#&gt;       car       bus       air      rail </span></a>
<a class="sourceLine" id="cb1-267" title="267"><span class="co">#&gt; 2132.5870  399.3251 1645.7480 2822.3399</span></a>
<a class="sourceLine" id="cb1-268" title="268"></a>
<a class="sourceLine" id="cb1-269" title="269"><span class="co">### Compare predictions</span></a>
<a class="sourceLine" id="cb1-270" title="270">change=(predictions_new<span class="op">-</span>predictions_base)<span class="op">/</span>predictions_base</a>
<a class="sourceLine" id="cb1-271" title="271"><span class="co">### Not interested in chosen alternative now, </span></a>
<a class="sourceLine" id="cb1-272" title="272"><span class="co">### so drop last column</span></a>
<a class="sourceLine" id="cb1-273" title="273">change=change[,<span class="op">-</span><span class="kw">ncol</span>(change)]</a>
<a class="sourceLine" id="cb1-274" title="274"><span class="co">### Summary of changes (possible presence of NAs due to</span></a>
<a class="sourceLine" id="cb1-275" title="275"><span class="co">### unavailable alternatives)</span></a>
<a class="sourceLine" id="cb1-276" title="276"><span class="kw">summary</span>(change)</a>
<a class="sourceLine" id="cb1-277" title="277"><span class="co">#&gt;        ID    Choice situation      car              bus        </span></a>
<a class="sourceLine" id="cb1-278" title="278"><span class="co">#&gt;  Min.   :0   Min.   :0        Min.   :0.0000   Min.   :0.0000  </span></a>
<a class="sourceLine" id="cb1-279" title="279"><span class="co">#&gt;  1st Qu.:0   1st Qu.:0        1st Qu.:0.0725   1st Qu.:0.0738  </span></a>
<a class="sourceLine" id="cb1-280" title="280"><span class="co">#&gt;  Median :0   Median :0        Median :0.1168   Median :0.1218  </span></a>
<a class="sourceLine" id="cb1-281" title="281"><span class="co">#&gt;  Mean   :0   Mean   :0        Mean   :0.1105   Mean   :0.1225  </span></a>
<a class="sourceLine" id="cb1-282" title="282"><span class="co">#&gt;  3rd Qu.:0   3rd Qu.:0        3rd Qu.:0.1509   3rd Qu.:0.1674  </span></a>
<a class="sourceLine" id="cb1-283" title="283"><span class="co">#&gt;  Max.   :0   Max.   :0        Max.   :0.2339   Max.   :0.4326  </span></a>
<a class="sourceLine" id="cb1-284" title="284"><span class="co">#&gt;                               NA&#39;s   :1554     NA&#39;s   :686     </span></a>
<a class="sourceLine" id="cb1-285" title="285"><span class="co">#&gt;       air              rail        </span></a>
<a class="sourceLine" id="cb1-286" title="286"><span class="co">#&gt;  Min.   :0.0000   Min.   :-0.3028  </span></a>
<a class="sourceLine" id="cb1-287" title="287"><span class="co">#&gt;  1st Qu.:0.0704   1st Qu.:-0.2060  </span></a>
<a class="sourceLine" id="cb1-288" title="288"><span class="co">#&gt;  Median :0.1100   Median :-0.1340  </span></a>
<a class="sourceLine" id="cb1-289" title="289"><span class="co">#&gt;  Mean   :0.1121   Mean   :-0.1434  </span></a>
<a class="sourceLine" id="cb1-290" title="290"><span class="co">#&gt;  3rd Qu.:0.1517   3rd Qu.:-0.0723  </span></a>
<a class="sourceLine" id="cb1-291" title="291"><span class="co">#&gt;  Max.   :0.3677   Max.   :-0.0022  </span></a>
<a class="sourceLine" id="cb1-292" title="292"><span class="co">#&gt;  NA&#39;s   :1736     NA&#39;s   :882</span></a></code></pre></div>
</div>
<div id="mmnl-model-file-example" class="section level2">
<h2>MMNL model file example</h2>
<p>In this section, we present code to estimate a mixed MNL model (MMNL) using the synthetic data included in the package. After estimation, we predict the effect of a 10% increase in the train fares. The utility function of the model remains the same than in the previous example, i.e.:</p>
<p><span class="math display">\[U_{nsi} = asc_i + \beta_{tt}tt_{nsi} + \beta_{c}*cost_{nsi} + \varepsilon_{nsi}\]</span></p>
<p>Where <em>n</em> indexes individuals, <em>s</em> choice scenarios, and <em>i</em> alternatives. <span class="math inline">\(asc_i\)</span> is the alternative specific constant, <span class="math inline">\(tt_{nsi}\)</span> is the travel time and <span class="math inline">\(cost_{nsi}\)</span> is the cost. <span class="math inline">\(\varepsilon_{nsi}\)</span> is an independent identically distributed standard Gumbel error term. <span class="math inline">\(\beta_{tt}\)</span> follows a log-normal distribution with the underlying normal having a mean <span class="math inline">\(\mu_{tt}\)</span> and standard deviation <span class="math inline">\(\sigma_{tt}\)</span>. <span class="math inline">\(asc_i\)</span>, <span class="math inline">\(\beta_{c}\)</span>, <span class="math inline">\(\mu_{tt}\)</span> and <span class="math inline">\(\sigma_{tt}\)</span> are parameters to be estimated.</p>
<p>The likelihood function of this model for individual <span class="math inline">\(n\)</span> is as follows.</p>
<p><span class="math display">\[L_{n}=\int_{\beta_{tt}}\prod_{s}P_{nsi}f(\beta_{tt})d\beta_{tt}\]</span></p>
<p>Where <span class="math inline">\(P_{nsi}=\frac{e^{V_{nsi}}}{\sum_{j}e^{V_{nsj}}}\)</span>, <span class="math inline">\(V_{nsi}=U_{nsi}-\varepsilon_{nsi}\)</span>, and <span class="math inline">\(f\)</span> is the probability density function of <span class="math inline">\(\beta_{tt}\)</span>. As this function does not have an analytical closed form, we estimate it using Monte Carlo integration, i.e.:</p>
<p><span class="math display">\[L_{n}\approx\frac{1}{R}\sum_{\beta_{tt}^r}\prod_{s}P_{nsi}^r\]</span> Where <span class="math inline">\(P_{nsi}^r=P_{nsi}(\beta_{tt}^r)\)</span>, with <span class="math inline">\(\beta_{tt}^r\)</span> a random draw of <span class="math inline">\(\beta_{tt}\)</span> from its distribution <span class="math inline">\(f\)</span>, and R is a big number.</p>
<p>The code is very similar to the previous example, with only sections 1 and 3 changing. * In section 1 we set <code>mixing = TRUE</code> inside apollo_control, and we set <code>nCores = 2</code> to speed up estimation by using two computing threads (this is not mandatory). * In section 3 we define the mean (<code>b_tt_mu</code>) and standar deviation (<code>b_tt_sigma</code>) of the underlying normal distribution. We then define the type, name and number of draws used. Finally, we construct the random coefficient <span class="math inline">\(\beta_{tt}\)</span> inside a function called <code>apollo_randCoeff</code>. We use 500 inter-individual draws that come from a standard normal distribution, which we later transform into log-normals inside <code>apollo_randCoeff</code>.</p>
<p>Even though in this case we only use <em>inter</em>-individual draws, note that <em>inter</em> and <em>intra</em>-individuals draws can be used simultaneously. <em>Inter</em>-individual draws capture variability <em>between</em> individuals, while <em>intra</em>-individual draws capture variability <em>within</em> individuals. In terms of the Monte Carlo integration, <em>inter</em>-individual draws are common for all observations from the same individual, while <em>intra</em>-individual draws are different for each observations. In terms of the likelihood function, the use of <em>intra</em>-individual draws would lead to <span class="math inline">\(L_{n}\approx\prod_{s}\frac{1}{R}\sum_{\beta_{tt}^r}P_{nsi}\)</span>, which is <strong>not</strong> the case in this model.</p>
<p>Estimation of models with mixing is computationally more demanding than models without mixing. Furthermore, using both <em>inter</em> and <em>intra</em>-individual requires large amounts of memory, which can further slow the estimation process. For this reason, this example is not run automatically. Yet, the users may copy and paste the code in a script, and run it themselves.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#### 1. Definition of core settings                        </span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">### Clear memory</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">### Load libraries</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">library</span>(apollo)</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">### Initialise code</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="kw">apollo_initialise</span>()</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">### Set core controls</span></a>
<a class="sourceLine" id="cb2-15" title="15">apollo_control =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="dt">modelName  =</span><span class="st">&quot;MMNL&quot;</span>,</a>
<a class="sourceLine" id="cb2-17" title="17">  <span class="dt">modelDescr =</span><span class="st">&quot;Simple MMNL model on mode choice SP data&quot;</span>,</a>
<a class="sourceLine" id="cb2-18" title="18">  <span class="dt">indivID    =</span><span class="st">&quot;ID&quot;</span>,</a>
<a class="sourceLine" id="cb2-19" title="19">  <span class="dt">mixing     =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="dt">nCores     =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-21" title="21">)</a>
<a class="sourceLine" id="cb2-22" title="22"></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">#### 2. Data loading                                   ####</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-26" title="26"></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="kw">data</span>(<span class="st">&quot;apollo_modeChoiceData&quot;</span>)</a>
<a class="sourceLine" id="cb2-28" title="28">database =<span class="st"> </span>apollo_modeChoiceData</a>
<a class="sourceLine" id="cb2-29" title="29"><span class="kw">rm</span>(apollo_modeChoiceData)</a>
<a class="sourceLine" id="cb2-30" title="30"></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">### Use only SP data</span></a>
<a class="sourceLine" id="cb2-32" title="32">database =<span class="st"> </span><span class="kw">subset</span>(database,database<span class="op">$</span>SP<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-33" title="33"></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co">### Create new variable with average income</span></a>
<a class="sourceLine" id="cb2-35" title="35">database<span class="op">$</span>mean_income =<span class="st"> </span><span class="kw">mean</span>(database<span class="op">$</span>income)</a>
<a class="sourceLine" id="cb2-36" title="36"></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co">#### 3. Parameter definition                           ####</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-40" title="40"></a>
<a class="sourceLine" id="cb2-41" title="41"><span class="co">### Vector of parameters, including any that are kept fixed </span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co">### during estimation</span></a>
<a class="sourceLine" id="cb2-43" title="43">apollo_beta=<span class="kw">c</span>(<span class="dt">asc_car  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-44" title="44">              <span class="dt">asc_bus  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-45" title="45">              <span class="dt">asc_air  =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-46" title="46">              <span class="dt">asc_rail =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-47" title="47">              <span class="dt">mu_tt    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-48" title="48">              <span class="dt">sigma_tt =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-49" title="49">              <span class="dt">b_c      =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-50" title="50"></a>
<a class="sourceLine" id="cb2-51" title="51"><span class="co">### Vector with names (in quotes) of parameters to be</span></a>
<a class="sourceLine" id="cb2-52" title="52"><span class="co">###  kept fixed at their starting value in apollo_beta.</span></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="co">### Use apollo_beta_fixed = c() for no fixed parameters.</span></a>
<a class="sourceLine" id="cb2-54" title="54">apollo_fixed =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;asc_car&quot;</span>)</a>
<a class="sourceLine" id="cb2-55" title="55"></a>
<a class="sourceLine" id="cb2-56" title="56"><span class="co">### Set parameters for generating draws</span></a>
<a class="sourceLine" id="cb2-57" title="57">apollo_draws =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-58" title="58">  <span class="dt">interDrawsType =</span> <span class="st">&quot;halton&quot;</span>,</a>
<a class="sourceLine" id="cb2-59" title="59">  <span class="dt">interNDraws    =</span> <span class="dv">500</span>,</a>
<a class="sourceLine" id="cb2-60" title="60">  <span class="dt">interUnifDraws =</span> <span class="kw">c</span>(),</a>
<a class="sourceLine" id="cb2-61" title="61">  <span class="dt">interNormDraws =</span> <span class="kw">c</span>(<span class="st">&quot;draws_tt&quot;</span>),</a>
<a class="sourceLine" id="cb2-62" title="62">  <span class="dt">intraDrawsType =</span> <span class="st">&quot;halton&quot;</span>,</a>
<a class="sourceLine" id="cb2-63" title="63">  <span class="dt">intraNDraws    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-64" title="64">  <span class="dt">intraUnifDraws =</span> <span class="kw">c</span>(),</a>
<a class="sourceLine" id="cb2-65" title="65">  <span class="dt">intraNormDraws =</span> <span class="kw">c</span>()</a>
<a class="sourceLine" id="cb2-66" title="66">)</a>
<a class="sourceLine" id="cb2-67" title="67"></a>
<a class="sourceLine" id="cb2-68" title="68"><span class="co">### Create random parameters</span></a>
<a class="sourceLine" id="cb2-69" title="69">apollo_randCoeff =<span class="st"> </span><span class="cf">function</span>(apollo_beta, apollo_inputs){</a>
<a class="sourceLine" id="cb2-70" title="70">  randcoeff =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb2-71" title="71"></a>
<a class="sourceLine" id="cb2-72" title="72">  randcoeff[[<span class="st">&quot;b_tt&quot;</span>]] =<span class="st"> </span><span class="op">-</span><span class="kw">exp</span>(mu_tt <span class="op">+</span><span class="st"> </span>sigma_tt<span class="op">*</span>draws_tt)</a>
<a class="sourceLine" id="cb2-73" title="73"></a>
<a class="sourceLine" id="cb2-74" title="74">  <span class="kw">return</span>(randcoeff)</a>
<a class="sourceLine" id="cb2-75" title="75">}</a>
<a class="sourceLine" id="cb2-76" title="76"></a>
<a class="sourceLine" id="cb2-77" title="77"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-78" title="78"><span class="co">#### 4. Input validation                               ####</span></a>
<a class="sourceLine" id="cb2-79" title="79"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-80" title="80"></a>
<a class="sourceLine" id="cb2-81" title="81">apollo_inputs =<span class="st"> </span><span class="kw">apollo_validateInputs</span>()</a>
<a class="sourceLine" id="cb2-82" title="82"></a>
<a class="sourceLine" id="cb2-83" title="83"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-84" title="84"><span class="co">#### 5. Likelihood definition                          ####</span></a>
<a class="sourceLine" id="cb2-85" title="85"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-86" title="86"></a>
<a class="sourceLine" id="cb2-87" title="87">apollo_probabilities=<span class="cf">function</span>(apollo_beta, apollo_inputs, </a>
<a class="sourceLine" id="cb2-88" title="88">                              <span class="dt">functionality=</span><span class="st">&quot;estimate&quot;</span>){</a>
<a class="sourceLine" id="cb2-89" title="89"></a>
<a class="sourceLine" id="cb2-90" title="90">  <span class="co">### Attach inputs and detach after function exit</span></a>
<a class="sourceLine" id="cb2-91" title="91">  <span class="kw">apollo_attach</span>(apollo_beta, apollo_inputs)</a>
<a class="sourceLine" id="cb2-92" title="92">  <span class="kw">on.exit</span>(<span class="kw">apollo_detach</span>(apollo_beta, apollo_inputs))</a>
<a class="sourceLine" id="cb2-93" title="93"></a>
<a class="sourceLine" id="cb2-94" title="94">  <span class="co">### Create list of probabilities P</span></a>
<a class="sourceLine" id="cb2-95" title="95">  P =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb2-96" title="96">  </a>
<a class="sourceLine" id="cb2-97" title="97">  <span class="co">### List of utilities: these must use the same names as</span></a>
<a class="sourceLine" id="cb2-98" title="98">  <span class="co">### in mnl_settings, order is irrelevant.</span></a>
<a class="sourceLine" id="cb2-99" title="99">  V =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb2-100" title="100">  V[[<span class="st">&#39;car&#39;</span>]]  =<span class="st"> </span>asc_car  <span class="op">+</span><span class="st"> </span>b_tt<span class="op">*</span>time_car  <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_car</a>
<a class="sourceLine" id="cb2-101" title="101">  V[[<span class="st">&#39;bus&#39;</span>]]  =<span class="st"> </span>asc_bus  <span class="op">+</span><span class="st"> </span>b_tt<span class="op">*</span>time_bus  <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_bus </a>
<a class="sourceLine" id="cb2-102" title="102">  V[[<span class="st">&#39;air&#39;</span>]]  =<span class="st"> </span>asc_air  <span class="op">+</span><span class="st"> </span>b_tt<span class="op">*</span>time_air  <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_air   </a>
<a class="sourceLine" id="cb2-103" title="103">  V[[<span class="st">&#39;rail&#39;</span>]] =<span class="st"> </span>asc_rail <span class="op">+</span><span class="st"> </span>b_tt<span class="op">*</span>time_rail <span class="op">+</span><span class="st"> </span>b_c<span class="op">*</span>cost_rail  </a>
<a class="sourceLine" id="cb2-104" title="104">  </a>
<a class="sourceLine" id="cb2-105" title="105">  <span class="co">### Define settings for MNL model component</span></a>
<a class="sourceLine" id="cb2-106" title="106">  mnl_settings =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-107" title="107">    <span class="dt">alternatives  =</span> <span class="kw">c</span>(<span class="dt">car=</span><span class="dv">1</span>, <span class="dt">bus=</span><span class="dv">2</span>, <span class="dt">air=</span><span class="dv">3</span>, <span class="dt">rail=</span><span class="dv">4</span>), </a>
<a class="sourceLine" id="cb2-108" title="108">    <span class="dt">avail         =</span> <span class="kw">list</span>(<span class="dt">car=</span>av_car, <span class="dt">bus=</span>av_bus, </a>
<a class="sourceLine" id="cb2-109" title="109">                         <span class="dt">air=</span>av_air, <span class="dt">rail=</span>av_rail), </a>
<a class="sourceLine" id="cb2-110" title="110">    <span class="dt">choiceVar     =</span> choice,</a>
<a class="sourceLine" id="cb2-111" title="111">    <span class="dt">V             =</span> V</a>
<a class="sourceLine" id="cb2-112" title="112">  )</a>
<a class="sourceLine" id="cb2-113" title="113">  </a>
<a class="sourceLine" id="cb2-114" title="114">  <span class="co">### Compute probabilities using MNL model</span></a>
<a class="sourceLine" id="cb2-115" title="115">  P[[<span class="st">&#39;model&#39;</span>]] =<span class="st"> </span><span class="kw">apollo_mnl</span>(mnl_settings, functionality)</a>
<a class="sourceLine" id="cb2-116" title="116"></a>
<a class="sourceLine" id="cb2-117" title="117">  <span class="co">### Take product across observation for same individual</span></a>
<a class="sourceLine" id="cb2-118" title="118">  P =<span class="st"> </span><span class="kw">apollo_panelProd</span>(P, apollo_inputs, functionality)</a>
<a class="sourceLine" id="cb2-119" title="119">  </a>
<a class="sourceLine" id="cb2-120" title="120">  <span class="co">### Average draws</span></a>
<a class="sourceLine" id="cb2-121" title="121">  P =<span class="st"> </span><span class="kw">apollo_avgInterDraws</span>(P, apollo_inputs, functionality)</a>
<a class="sourceLine" id="cb2-122" title="122">  </a>
<a class="sourceLine" id="cb2-123" title="123">  <span class="co">### Prepare and return outputs of function</span></a>
<a class="sourceLine" id="cb2-124" title="124">  P =<span class="st"> </span><span class="kw">apollo_prepareProb</span>(P, apollo_inputs, functionality)</a>
<a class="sourceLine" id="cb2-125" title="125">  <span class="kw">return</span>(P)</a>
<a class="sourceLine" id="cb2-126" title="126">}</a>
<a class="sourceLine" id="cb2-127" title="127"></a>
<a class="sourceLine" id="cb2-128" title="128"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-129" title="129"><span class="co">#### 6. Model estimation and reporting                 ####</span></a>
<a class="sourceLine" id="cb2-130" title="130"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-131" title="131"></a>
<a class="sourceLine" id="cb2-132" title="132">model =<span class="st"> </span><span class="kw">apollo_estimate</span>(apollo_beta, apollo_fixed, </a>
<a class="sourceLine" id="cb2-133" title="133">                        apollo_probabilities, </a>
<a class="sourceLine" id="cb2-134" title="134">                        apollo_inputs)</a>
<a class="sourceLine" id="cb2-135" title="135"></a>
<a class="sourceLine" id="cb2-136" title="136"><span class="kw">apollo_modelOutput</span>(model)</a>
<a class="sourceLine" id="cb2-137" title="137"></a>
<a class="sourceLine" id="cb2-138" title="138"><span class="kw">apollo_saveOutput</span>(model)</a>
<a class="sourceLine" id="cb2-139" title="139"></a>
<a class="sourceLine" id="cb2-140" title="140"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-141" title="141"><span class="co">#### 7. Postprocessing of results                      ####</span></a>
<a class="sourceLine" id="cb2-142" title="142"><span class="co"># ####################################################### #</span></a>
<a class="sourceLine" id="cb2-143" title="143"></a>
<a class="sourceLine" id="cb2-144" title="144"><span class="co">### Use the estimated model to make predictions</span></a>
<a class="sourceLine" id="cb2-145" title="145">predictions_base =<span class="st"> </span><span class="kw">apollo_prediction</span>(model, </a>
<a class="sourceLine" id="cb2-146" title="146">                                     apollo_probabilities, </a>
<a class="sourceLine" id="cb2-147" title="147">                                     apollo_inputs)</a>
<a class="sourceLine" id="cb2-148" title="148"></a>
<a class="sourceLine" id="cb2-149" title="149"><span class="co">### Now imagine the cost for rail increases by 10% </span></a>
<a class="sourceLine" id="cb2-150" title="150"><span class="co">### and predict again</span></a>
<a class="sourceLine" id="cb2-151" title="151">database<span class="op">$</span>cost_rail =<span class="st"> </span><span class="fl">1.1</span><span class="op">*</span>database<span class="op">$</span>cost_rail</a>
<a class="sourceLine" id="cb2-152" title="152">predictions_new =<span class="st"> </span><span class="kw">apollo_prediction</span>(model, </a>
<a class="sourceLine" id="cb2-153" title="153">                                    apollo_probabilities, </a>
<a class="sourceLine" id="cb2-154" title="154">                                    apollo_inputs)</a>
<a class="sourceLine" id="cb2-155" title="155"></a>
<a class="sourceLine" id="cb2-156" title="156"><span class="co">### Compare predictions</span></a>
<a class="sourceLine" id="cb2-157" title="157">change=(predictions_new<span class="op">-</span>predictions_base)<span class="op">/</span>predictions_base</a>
<a class="sourceLine" id="cb2-158" title="158"><span class="co">### Not interested in chosen alternative now, </span></a>
<a class="sourceLine" id="cb2-159" title="159"><span class="co">### so drop last column</span></a>
<a class="sourceLine" id="cb2-160" title="160">change=change[,<span class="op">-</span><span class="kw">ncol</span>(change)]</a>
<a class="sourceLine" id="cb2-161" title="161"><span class="co">### Summary of changes (possible presence of NAs due to</span></a>
<a class="sourceLine" id="cb2-162" title="162"><span class="co">### unavailable alternatives)</span></a>
<a class="sourceLine" id="cb2-163" title="163"><span class="kw">summary</span>(change)</a></code></pre></div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li>Ben-Akiva, M. and Lerman, S. (1985) <em>Discrete Choice Analysis</em>. Cambridge, Massachusetts. The MIT Press. ISBN 978-0-262-02217-0</li>
<li>Ben-Akiva, M.; McFadden, D.; Train, K.; Walker, J.; Bhat, C.; Bierlaire, M.; Bolduc, D.; Boersch-Supan, A.; Brownstone, D.; Bunch, D.; Daly, A.; De Palma, A.; Gopinath, D.; Karlstrom, A.; Munizaga, M. (2002) Hybrid Choice Models: Progress and Challenges. <em>Marketing Letters</em> <strong>13</strong>, 163 - 175.</li>
<li>Bhat, C. (2008) The multiple discrete-continuous extreme value (MDCEV) model: Role of utility function parameters, identification considerations,and model extensions. <em>Transportation Research</em> <strong>42B</strong>, 274 - 303.</li>
<li>Hancock, T.; Hess, S. and Choudhury, C. (2018) Decision field theory: Improvements to current methodology and comparisons with standard choice modelling techniques. <em>Transportation Research</em> <strong>107B</strong>, 18-40.</li>
<li>Pinjari, A. and Bhat, C. (2010) A multiple discrete–continuous nested extreme value (MDCNEV) model: Formulation and application to non-worker activity time-use and timing behavior on weekdays. <em>Transportation Research</em> <strong>44B</strong>, 562 - 583.</li>
<li>Train, K. (2009) <em>Discrete Choice Methods with Simulation</em>, 2nd edition. New York, New York. Cambridge University Press. ISBN 978-0-521-76655-5</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
